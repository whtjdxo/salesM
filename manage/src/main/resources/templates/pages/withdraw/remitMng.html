<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/default}" layout:fragment="Content">
  <head>
    <title>송금 관리</title>
    <script src="/vendors/tinymce/tinymce.min.js"></script>
    <script src="/vendors/datatables.net/dataTables.min.js"></script>
    <script src="/vendors/datatables.net-bs5/dataTables.bootstrap5.min.js"></script>
    <script src="/vendors/datatables.net-fixedcolumns/dataTables.fixedColumns.min.js"></script>
    <script src="/vendors/dropzone/dropzone-min.js"></script>
    <script src="/js/jquery.form.js"></script> 
    <link rel="stylesheet" href="/vendors/datatables.net-bs5/dataTables.bootstrap5.min.css" />    
    <!-- DataTables Select CSS 추가 -->
    <link rel="stylesheet" href="/css/custom-salesm.css" />

    <script th:inline="none">      
      $(document).ready(function () {           
        $('#frm_sch').onLoadFunction();           
        $('#frm_sch_list').onLoadFunction();      

        callAjax('/common/getCreditCorpList', "", fn_corp_list_setting);
        function fn_corp_list_setting(data) {
          codeSetting('CORP_CD', data.data, '#sch_corp_no', '여신사', '', ''); 
        }

        callAjax('/common/getAgencyList', "", fn_agency_list_setting);
        function fn_agency_list_setting(data) {
          codeSetting('AGENCY_CD', data.data, '#sch_agency_cd', '대리점', '', ''); 
        }   
        var toDay = returnDate('today'); // 오늘 날짜 계산 
        $('#sch_remit_dt').val(toDay);        

        $('#btn_search').click(function () {   
          if ($('#sch_remit_dt').val() !== toDay) {
            $('#btn_remit_cancel').hide();
          } else {
            $('#btn_remit_cancel').show();
          }
          tbl_remit_summ.ajax.reload();
        });  

        $('#btn_list_search').click(function () {   
          tbl_remit_list.ajax.reload();
        }); 

        var tbl_remit_summ = $('#tbl_remit_summ').DataTable({
          processing: true,
          serverSide: true,
          select: true, // select 옵션은 DataTables Select 확장이 필요할 수 있습니다. 여기서는 체크박스 동작과 직접 관련은 적습니다.
          responsive: true,
          ajax: {
              url: '/withdraw/withdraw/remitMng/remitSummary',
              contentType: 'application/json',
              dataType: 'JSON',
              type: 'POST',
              data: function (postData) {
                  var formData = $('#frm_sch').serializeObject(); // serializeObject는 jQuery 플러그인일 수 있습니다.
                  Object.assign(postData, formData);
                  return JSON.stringify(postData);
              },
              dataSrc: function (json) {
                    // totalSummary 저장
                    totalSumm = json.totalSumm || {};
                    return json.data;
                },
              // 서버 에러 처리 등 추가 가능
              error: function(jqXHR, textStatus, errorThrown) {
                  console.error("DataTables Ajax Error: ", textStatus, errorThrown); 
              }
          },
          columns: [              
              {
                data: 'remit_status',
                render: function(data, type, row) {
                  if (data === 'T00000') {
                      return '<input type="hidden" class="form-check-input row-checkbox" value="' + row.remit_no + '" disabled">';
                    // return '<input type="checkbox" class="form-check-input row-checkbox" value="' + row.remit_no + '" disabled style="opacity:0.5;">';
                  } else {
                    return '<input type="checkbox" class="form-check-input row-checkbox" value="' + row.remit_no + '">';
                  }
                },
                orderable: false,
                className: 'text-center dt-body-center'
              }
              , { data: 'chain_nm' }
              , { data: 'biz_no' }
              , { data: 'ceo_nm' }
              
              , { data: 'remit_status_nm' } 

              , { data: 'remit_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }

              , { data: 'conf_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
              , { data: 'card_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
              , { data: 'card_resv_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }

              , { data: 'wd_base_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
              , { data: 'svc_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
              , { data: 'crd_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
              , { data: 'wd_remit_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }

              , { data: 'exc_remit_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }              
              , { data: 'sub_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }

          ],
          columnDefs: [
              { targets: 0, width: '40px', className: 'text-center dt-body-center' }, // 중앙 정렬 확인
              { targets: 1, width: '150px', className: 'text-left px-1' },
              { targets: 2, width: '120px', className: 'text-left px-1' },
              { targets: 3, width: '100px', className: 'text-left px-1' },
              { targets: 4, width: '100px', className: 'text-left px-1' }, 

              { targets: 5, width: '120px', className: 'text-right px-1 dt-body-right' }, 


              { targets: 6, width: '120px', className: 'text-right px-1 dt-body-right' }, 
              { targets: 7, width: '120px', className: 'text-right px-1 dt-body-right' },
              { targets: 8, width: '120px', className: 'text-right px-1 dt-body-right' },

              { targets: 9, width: '120px', className: 'text-right px-1 dt-body-right' },
              { targets: 10, width: '120px', className: 'text-right px-1 dt-body-right' },                
              { targets: 11, width: '120px', className: 'text-right px-1 dt-body-right' },
              { targets: 12, width: '120px', className: 'text-right px-1 dt-body-right' }, 

              { targets: 13, width: '120px', className: 'text-right px-1 dt-body-right' },
              { targets: 14, width: '120px', className: 'text-right px-1 dt-body-right' }, 
          ],
          order: [[0, 'asc']], // 기본 정렬 설정
          paging: true,
          lengthChange: false,
          searching: false,
          ordering: true,
          info: false, // 필요에 따라 true로 변경
          autoWidth: false, 
          // scrollCollapse: true,
          scrollY: '340px',
          pageLength: 15,
          language: {
              emptyTable: '데이터가 없습니다.',
              zeroRecords: '일치하는 데이터가 없습니다.',
              loadingRecords: '로딩중...',
              processing: '<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">처리중...</span></div>', // 로딩/처리중 시각적 표시 개선
          },          
          footerCallback: function (row, data, start, end, display) {
                var api = this.api();
                const renderNumber = $.fn.dataTable.render.number(',', '.', 0, '').display;
                const colMap = {
                  5: 'remit_amt',
                  6: 'conf_amt', 
                  7: 'card_fee_amt', 
                  8: 'card_resv_amt',
                  9: 'wd_base_amt',
                  10: 'svc_fee_amt',
                  11: 'crd_fee_amt',
                  12: 'wd_remit_amt', 
                  13: 'exc_remit_amt',
                  14: 'sub_amt', 
                };

                Object.entries(colMap).forEach(([colIdx, key]) => {
                    const footer = api.column(Number(colIdx)).footer();
                    if (footer) {
                        const val = totalSumm[key] || 0;
                        $(footer).html(renderNumber(val));
                    }
                });

                // // 기타 푸터 설정
                // $(api.column(0).footer()).html('');
                // $(api.column(1).footer()).html('합계:'); 
            },

          // =============================================================
          // 중요: 테이블이 다시 그려질 때마다 체크박스 상태를 업데이트
          // =============================================================
          drawCallback: function( settings ) {
            // 1. 헤더 체크박스 상태 초기화 (선택 사항: 페이지 넘길 때마다 초기화할지 결정)
            // $('#check_all').prop('checked', false); // 필요하다면 주석 해제
            // 2. 현재 페이지의 모든 행 체크박스가 선택되었는지 확인하여 헤더 체크박스 상태 업데이트
            updateCheckAllState();
          }
        });

        // --- 전체 선택/해제 체크박스 클릭 이벤트 ---
        $('#check_all').on('click', function(){
            var isChecked = this.checked;
            // 현재 페이지의 모든 행 체크박스를 찾아서 상태 변경
            tbl_remit_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox').prop('checked', isChecked);
        });

        // --- 각 행의 체크박스 클릭 이벤트 (이벤트 위임 사용) ---
        $('#tbl_remit_summ tbody').on('click', '.row-checkbox', function(){
            // 개별 체크박스 클릭 시 '전체 선택' 체크박스 상태 업데이트
            updateCheckAllState();
        });

        // --- '전체 선택' 체크박스 상태 업데이트 함수 ---
        function updateCheckAllState() {
            var $rowCheckboxes = tbl_remit_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox');
            var totalCheckboxes = $rowCheckboxes.length;
            var checkedCheckboxes = $rowCheckboxes.filter(':checked').length;

            // 모든 체크박스가 선택되었는지 확인
            var allChecked = totalCheckboxes > 0 && totalCheckboxes === checkedCheckboxes;
            $('#check_all').prop('checked', allChecked);

            // 하나라도 선택된 경우 vs 모두 선택되지 않은 경우 (선택 사항: indeterminate 상태 구현)
            if (checkedCheckboxes > 0 && checkedCheckboxes < totalCheckboxes) {
                $('#check_all').prop('indeterminate', true); // 일부만 선택되었을 때 중간 상태 표시
            } else {
                $('#check_all').prop('indeterminate', false);
            }
        } 
 
        $('#tbl_remit_summ').on('click', 'tr', function (e) {                 
          
          if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');     
            $(this).find('.row-checkbox').prop('checked', false);       
          } else {
            tbl_remit_summ.$('tr.selected').removeClass('selected');      
            $(this).addClass('selected');            
            $(this).find('.row-checkbox').prop('checked', true);
          }
          
          var row = tbl_remit_summ.row(this).data();
          $('#frm_sch_list')[0].reset();
          $('#sch_list_chain_no').val(row.chain_no);   // list 검색 조건          
          $('#sch_list_remit_no').val(row.remit_no);
          $('#sch_sub_recv_remit_no').val(row.remit_no);
          
          $('#chain_nm').val(row.chain_nm);
          $('#biz_no').val(row.biz_no);
          $('#ceo_nm').val(row.ceo_nm);
          // $('#bbank_nm').val(row.bbank_nm);
          // $('#bbank_account_no').val(row.bbank_account_no);
          $('#tot_conf_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.conf_amt));
          $('#card_fee_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.card_fee_amt));
          $('#card_resv_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.card_resv_amt));
          $('#svc_fee_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.svc_fee_amt));      
          $('#crd_fee_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.crd_fee_amt));
          $('#wd_base_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.wd_base_amt));

          if (row.sub_amt > 0) {
            $('#sub_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.sub_amt))
              .css({ 'color': 'red', 'font-weight': 'bold' });
          } else {
            $('#sub_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.sub_amt))
              .css({ 'color': '', 'font-weight': '' });
          }
          
          $('#exc_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.exc_remit_amt));
          
          if (row.remit_amt > 0) {
            $('#remit_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.remit_amt))
              .css({ 'color': 'blue', 'font-weight': 'bold' });
          } else if (row.remit_amt < 0) {
            $('#remit_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.remit_amt))
              .css({ 'color': 'red', 'font-weight': 'bold' });
          } else {
            $('#remit_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.remit_amt))
              .css({ 'color': '', 'font-weight': '' });
          }  
          tbl_remit_list.ajax.reload(); // 상세 리스트 조회
        });

        $('#btn_remit_cancel').click(function () {
          var selectRemitNos = [];
          // Iterate through checked checkboxes in the current page
          tbl_remit_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox:checked').each(function () {
            selectRemitNos.push($(this).val());
          });
          
          var dataParam ="";          
          if (selectRemitNos.length === 0) {
            alert('취소 할 가맹점을 선택하세요.');
            return;
          }
          dataParam ={
            remitNo : selectRemitNos.join(','),
          }   
          ConfirmdialogToAjax("execute","/withdraw/withdraw/remitMng/remitCancel", dataParam, fn_remit_result);
        });

        function getSelectedRemitNos() {
            var selectedRemitNo = [];            
            // 체크박스가 체크된 행 찾기
            $('#tbl_remit_summ tbody input.row-checkbox:checked').each(function() {
                var remitNo = $(this).val();
                if (remitNo !== 'T00000') { // T00000은 제외 (disabled 처리된 항목)
                    selectedRemitNo.push(remitNo);
                }
            });            
            return selectedRemitNo.join(','); // 배열을 쉼표로 구분된 문자열로 변환
        }
        // Excel download button click event
        $('#btn_remit_excel').click(function () {
          var formData = $('#frm_sch').serializeObject();         
          $('#globalLoadingBar').show();
          $.ajax({
            url: '/withdraw/withdraw/remitMng/remitSummExcel',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            xhrFields: {
              responseType: 'blob'
            },
            success: function (data, status, xhr) {
              var blob = new Blob([data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              var link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download = '송금자료.xlsx';
              link.click();
            },
            error: function (xhr, status, error) {
              alert('Excel download failed.');
            },
            complete: function () {
              $('#globalLoadingBar').hide();
            }
          });
        });

        // Excel download button click event
        $('#btn_bank_excel').click(function () {
          
          var selectedRemitNo = getSelectedRemitNos();
          if (!selectedRemitNo) {
            alert("선택된 항목이 없습니다.");
            return;
          }
          console.log("remit_no : ", selectedRemitNo);  
          var formData = {
            sch_remit_no : selectedRemitNo,
          }
          $('#globalLoadingBar').show();
          // var formData = $('#frm_sch').serializeObject();
          $.ajax({
            url: '/withdraw/withdraw/remitMng/remitBankExcel',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            xhrFields: {
              responseType: 'blob'
            },
            success: function (data, status, xhr) {
              var blob = new Blob([data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              var link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download = '송금_우리은행.xlsx';
              link.click();
            },
            error: function (xhr, status, error) {
              alert('Excel download failed.');
            },
            complete: function () {
              $('#globalLoadingBar').hide();
            }
          });
        });  

        $('#btn_remit_chain').click(function () {
          var selectRemitNos = [];
          // Iterate through checked checkboxes in the current page
          tbl_remit_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox:checked').each(function () {
            selectRemitNos.push($(this).val());
          });
          
          var dataParam ="";
          if ($('#remit_all').is(':checked')) {  
            if (!confirm("모두 송금완료로 처리하시겠습니까?")) {              
              return;
            }
            dataParam ={
              remitNo : 'ALL',
            }
          } else {
            if (selectRemitNos.length === 0) {
              alert('송금 처리 할 가맹점을 선택하세요.');
              return;
            }
            dataParam ={              
              remitNo : selectRemitNos.join(','),
            }  
          } 
          ConfirmdialogToAjax("execute","/withdraw/withdraw/remitMng/remitSend", dataParam, fn_remit_result);
        });

        function fn_remit_result(data){ 
          swal('성공', '작업을 정상적으로 완료하였습니다.', 'success');
          fn_default_clear();
          tbl_remit_summ.ajax.reload();
        }

        function fn_default_clear(){ 
          $('#frm_sch_list')[0].reset(); 
          $('#tbl_remit_list').DataTable().clear().draw();
        }
        
        var tbl_remit_list = $('#tbl_remit_list').DataTable({
          processing: true,
          serverSide: true,
          select: true,
          responsive: true,
          ajax: {
            url: '/withdraw/withdraw/remitMng/remitList',
            contentType: 'application/json',
            dataType: 'JSON',
            type: 'POST',
            data: function (postData) {
              formData = $('#frm_sch_list').serializeObject();
              Object.assign(postData, formData);
              return JSON.stringify(postData);
            },
          }, 
          columns: [   
            {
                data: null,
                render: function (data, type, row, meta) {
                  return meta.row + meta.settings._iDisplayStart + 1;
                },                    
            },          
            { data: 'wd_no' },
            { data: 'wd_status_nm' },
            { data: 'card_acq_nm' },
            { data: 'card_no' },
            { data: 'card_type_nm' },
            { data: 'conf_gb_nm' },
            { data: 'conf_no' },
            { data: 'conf_dttm' },
            { data: 'card_resv_date' },
            { data: 'conf_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },

            { data: 'card_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'card_resv_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'svc_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'wd_base_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'crd_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'remit_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'wd_memo' },
          ],
          columnDefs: [
            { targets: 0, width: '60px', className: 'text-center' },            
            { targets: 1, width: '120px', className: 'text-left' },
            { targets: 2, width: '80px', className: 'text-center' },
            { targets: 3, width: '80px', className: 'text-center' },
            { targets: 4, width: '150px', className: 'text-center' },
            { targets: 5, width: '80px', className: 'text-center' },
            { targets: 6, width: '80px', className: 'text-center' },
            { targets: 7, width: '100px', className: 'text-center' },
            { targets: 8, width: '150px', className: 'text-center' },
            { targets: 9, width: '120px', className: 'text-center' },
            { targets: 10, width: '120px', className: 'text-center' },
            { targets: 11, width: '100px', className: 'text-end' },
            { targets: 12, width: '120px', className: 'text-end' },
            { targets: 13, width: '100px', className: 'text-end' },
            { targets: 14, width: '120px', className: 'text-end' },
            { targets: 15, width: '100px', className: 'text-end' },
            { targets: 16, width: '120px', className: 'text-end' },
            { targets: 17, width: '100px', className: 'text-center' },            
          ],
          order: [[1, 'desc']],
          paging: true,
          lengthChange: false,
          searching: false,
          ordering: true,
          autoWidth: true,
          responsive: true,
          scrollCollapse: true,
          pageLength: 100,
          scrollY: '580px',
          info: false,
          language: {
            emptyTable: '데이터가 없습니다.',
            search: '검색:',
            zeroRecords: '일치하는 데이터가 없습니다.',
            loadingRecords: '로딩중...',
            processing: '처리중...',
          },          
        });

        $('#tbl_remit_list').on('click', 'tr', function () {
          if ($(this).hasClass('selected')) {
              $(this).removeClass('selected');
          } else {              
              tbl_remit_list.$('tr.selected').removeClass('selected');              
              $(this).addClass('selected');
          } 
        });
        
        // Excel download button click event
        $('#btn_list_excel').click(function () {
          var formData = $('#frm_sch_list').serializeObject();
          $('#globalLoadingBar').show();
          $.ajax({
            url: '/withdraw/withdraw/remitMng/remitListExcel',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            xhrFields: {
              responseType: 'blob'
            },
            success: function (data, status, xhr) {
              var blob = new Blob([data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              var link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download = '출금상세내역.xlsx';
              link.click();
            },
            error: function (xhr, status, error) {
              alert('Excel download failed.');
            },
            complete: function () {
              $('#globalLoadingBar').hide();
            }
          });
        }); 

        // Add click event for sub_amt input field
        $('#sub_amt').on('click', function () {
          var subAmtValue = parseFloat($(this).val().replace(/,/g, '')) || 0; // Remove commas and parse as float
          if (subAmtValue > 0) {
            $('#modal_sub_recv_list').modal('show'); // Show the modal
          }
        });
        
        // 모달 창 표시될때 초기화 처리
        $('#modal_sub_recv_list').on('shown.bs.modal', function() {  
          // 모달 열릴 때 첫 번째 포커스 가능 요소로 이동          
          $(this).data('trigger-element', document.activeElement);
          if ($.fn.DataTable.isDataTable('#tbl_sub_recv_list')) {
            $('#tbl_sub_recv_list').DataTable().destroy();
          }          
          // 새로 초기화
          $('#tbl_sub_recv_list').DataTable({ 
              processing: true,
              serverSide: true,
              select: true,
              responsive: true,
              ajax: {
                url: '/withdraw/withdraw/remitMng/remitSubRecvList',
                contentType: 'application/json',
                dataType: 'JSON',
                type: 'POST',
                data: function (postData) {
                  formData = $('#frm_modal_sub_recv').serializeObject();
                  Object.assign(postData, formData);
                  return JSON.stringify(postData);
                },
              },
              columns: [
                  { data: 'sub_no' },
                  { data: 'sub_code_nm' },
                  { data: 'sub_status_nm' },
                  { data: 'occur_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },  
                  { data: 'recv_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },  
                  { data: 'remain_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },  
                  { data: 'sub_memo' },
              ],
              columnDefs: [
                  { targets: 0, width: '130px', className: 'text-left' },
                  { targets: 1, width: '120px', className: 'text-left' },
                  { targets: 2, width: '120px', className: 'text-left' },
                  { targets: 3, width: '120px', className: 'text-end' },
                  { targets: 4, width: '120px', className: 'text-end' },
                  { targets: 5, width: '120px', className: 'text-end' },
                  { targets: 6, width: '200px', className: 'text-left' },
              ],
              order: [[1, 'desc']],
              paging: true,
              lengthChange: false,
              searching: false,
              ordering: true,
              autoWidth: false,
              responsive: true,
              scrollCollapse: true,
              pageLength: 10,
              scrollY: '380px',
              info: false,
              language: {
                emptyTable: '데이터가 없습니다.',
                search: '검색:',
                zeroRecords: '일치하는 데이터가 없습니다.',
                loadingRecords: '로딩중...',
                processing: '처리중...',
              },
          });
          // 첫 번째 포커스 가능 요소로 이동
          $(this).find('button:not([disabled]), input:not([disabled])').first().focus();           
        });
        
        // 모달이 닫힐 때 포커스 복원
        $('#modal_sub_recv_list').on('hidden.bs.modal', function() {
          var triggerElement = $(this).data('trigger-element');
          if (triggerElement) {
            $(triggerElement).focus();
          } 
          return true; // 모달 닫기 허용
        });
          
      });
    </script>
  </head>
  <div class="content">     
    <div class="row g-1 mb-1">
      <div class="col-lg-10">
        <div class="card" style="height: 620px;">
          <div class="card-header" style="height:110px;">          
            <div class="row flex-between-end">
              <div class="col-lg-2 align-self-center">
                <h4 class="mb-0">출금 관리</h4>
              </div>            
              <div class="col-lg-10">
                <form id="frm_sch" name="frm_sch" onsubmit="return false;" novalidate=""> 
                  <div class="row mb-1">
                    <div class="col-sm-7">
                      <div class="input-group input-group-sm mb-1">
                        <div class="col-sm-3">
                          <input class="form-control form-control-sm" id="sch_remit_dt" type="text" name="sch_remit_dt" istyle="date" maxlength="10" required />
                        </div>   
                        <select class="form-select form-control-sm me-1" id="sch_corp_no" name="sch_corp_no" style="width: 75px">
                          <option value="">여신사</option>
                        </select>
                        <select class="form-select form-control-sm me-1" id="sch_agency_cd" name="sch_agency_cd" style="width: 75px">
                          <option value="">대리점</option>
                        </select>                      
                        <input type="text" class="form-control form-control-sm me-1" id="schgb_chain_val" name="schgb_chain_val" style="width:100px" />
                        <button type="button" class="btn btn-primary btn-sm" id="btn_search" name="btn_search">조회</button>
                      </div>
                    </div> 
                    <div class="col-sm-5 text-end">
                      <!-- <div class="input-group mb-1"> -->
                        <button type="button" class="btn btn-success btn-sm" id="btn_remit_cancel" name="btn_remit_cancel">출금 정산 취소</button>
                        <button type="button" class="btn btn-info btn-sm" id="btn_remit_chain" name="btn_remit_chain">송금 완료 처리</button>
                        <button type="button" class="btn btn-primary btn-sm" id="btn_remit_excel" name="btn_remit_excel">송금자료 EXCEL</button>
                        <button type="button" class="btn btn-primary btn-sm" id="btn_bank_excel" name="btn_bank_excel">은행용 EXCEL</button>
                      <!-- </div> -->
                    </div>
                  </div> 
                  <!-- <div class="row mb-1">
                    <div class="col-sm-8">
                      <div class="col-sm-2">
                        <button type="button" class="btn btn-success btn-sm" id="btn_remit_cancel" name="btn_remit_cancel">출금 정산 취소</button>
                      </div>
                    </div>                    
                    <div class="col-sm-2">
                      <button type="button" class="btn btn-info btn-sm" id="btn_remit_chain" name="btn_remit_chain">송금 완료 처리</button>
                    </div>
                    <div class="col-sm-2 text-end">
                      <button type="button" class="btn btn-primary btn-sm" id="btn_bank_excel" name="btn_bank_excel">송금 자료 EXCEL</button>
                    </div>
                  </div> -->
                </form>                
              </div>
            </div>          
          </div>
          <div class="card-body pt-0 px-0" style="padding-top: 0px">
            <div class="table-responsive scrollbar">
              <table class="table table-striped table-sm fs-9 mb-0 selectable-table table-hover selectable" id="tbl_remit_summ">  
                <thead>
                  <tr>
                    <th rowspan="2" class="text-center">
                        <input type="checkbox" id="check_all" class="form-check-input" />
                    </th>
                    <th rowspan="2" class="text-center">가맹점 명</th>
                    <th rowspan="2" class="text-center">사업자 번호</th>
                    <th rowspan="2" class="text-center">대표자명</th>
                    <th rowspan="2" class="text-center">송금상태</th> 
                    <th rowspan="2" class="text-center">송금액</th> 

                    <th colspan="3" class="text-center">카드사 정산</th> 
                    <th colspan="4" class="text-center">출금 정산</th> 
                    <th colspan="2" class="text-center">과입/차감</th> 
                  </tr>
                  <tr>
                    <th class="text-center">매출 금액</th>
                    <th class="text-center">카드수수료</th>
                    <th class="text-center">입금 예정액</th>
                    
                    <th class="text-center">정산 원금</th>
                    <th class="text-center">서비스수수료</th> 
                    <th class="text-center">여신수수료</th> 
                    <th class="text-center">정산액</th> 

                    <th class="text-center">과입금</th>                     
                    <th class="text-center">차감 정산액</th> 
                  </tr>
                </thead>
                <tbody class="list"></tbody>
                <tfoot>
                  <tr>
                    <th colspan="5" class="text-center">총계</th>
                    <th class="text-right px-2"></th>

                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>

                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th> 
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>

                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>  
                  </tr>
                </tfoot>                
              </table>
            </div>
          </div>
        </div>      
      </div>
      <div class="col-lg-2">
        <div class="card" style="height: 620px;">    
          <div class="card-header">         
            <div class="col-lg align-self-center">
              <h4 class="mb-0">상세 정보</h4>
            </div>   
            <form id="frm_sch_card" name="frm_sch_card" onsubmit="return false;" novalidate="">
              <input class="form-control form-control-sm" id="sch_card_chain_no" type="hidden" name="sch_card_chain_no" readonly="readonly" />
              <input class="form-control form-control-sm" id="sch_card_remit_date" type="hidden" name="sch_card_remit_date"/>                
            </form>          
          </div>
          <div class="card-body pt-1 px-1" style="padding-top: 10px">  
            <div class="row flex-between-end">
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="chain_nm">가맹점명</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="chain_nm" type="text" name="chain_nm" istyle="amount" readonly />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="biz_no">사업자번호</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="biz_no" type="text" name="biz_no" istyle="amount" readonly />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="ceo_nm">대표자명</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="ceo_nm" type="text" name="ceo_nm" istyle="amount" readonly />
                    </div>
                  </div>
                </div>
              </div> 

              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="tot_conf_amt">총 정산금액</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="tot_conf_amt" type="text" name="tot_conf_amt" istyle="amount" readonly />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="card_fee_amt">카드 수수료</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="card_fee_amt" type="text" name="card_fee_amt" istyle="amount" readonly/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="card_resv_amt">입금 예정액</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="card_resv_amt" type="text" name="card_resv_amt" istyle="amount" readonly/>
                    </div>
                  </div>
                </div>  
              </div>
              <div class="row mb-1">            
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="svc_fee_amt">운영 수수료</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="svc_fee_amt" type="text" name="svc_fee_amt" istyle="amount" readonly/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">  
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="crd_fee_amt">여신 수수료</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="crd_fee_amt" type="text" name="crd_fee_amt" istyle="amount"  readonly />                           
                    </div>
                  </div>
                </div>  
              </div>
              <div class="row mb-1">            
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="wd_base_amt">원    금</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="wd_base_amt" type="text" name="wd_base_amt" istyle="amount" readonly />
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="sub_amt">차 감 액</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="sub_amt" type="text" name="sub_amt" istyle="amount" readonly/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="exc_amt">과 입 금</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="exc_amt" type="text" name="exc_amt" istyle="amount" readonly/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mb-1">
                <div class="col-sm-12">
                  <div class="input-group input-group-sm mb-1">
                    <label class="col-sm-4 col-form-label col-form-label-sm text-center" for="remit_amt">송금 예정액</label> 
                    <div class="col-sm-8">
                      <input class="form-control form-control-sm text-end bg-light" id="remit_amt" type="text" name="remit_amt" istyle="amount"  readonly />                           
                    </div>
                  </div>
                </div>
              </div> 
            </div>
          </div>          
        </div>      
      </div>        
    </div>     
    <div class="row g-1 mb-1">
      <div class="card">
        <div class="card-header"> 
          <div class="row flex-between-end">              
            <div class="col-lg-2 align-self-center">
              <h4 class="mb-0">출금 상세 List</h4>
            </div>     
            <div class="col-lg-10">
              <form id="frm_sch_list" name="frm_sch_list" onsubmit="return false;" novalidate=""> 
                <input id="sch_list_chain_no"  type="hidden" name="sch_list_chain_no" />
                <input id="sch_list_chain_nm"  type="hidden" name="sch_list_chain_nm" />
                <input id="sch_list_remit_no" type="hidden" name="sch_list_remit_no"/>
                <input id="sch_list_card_acq"  type="hidden" name="sch_list_card_acq" />
                <div class="row mb-1">
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">                                       
                      <select class="form-select form-control-sm me-1" id="sch_list_gb" name="sch_list_gb" style="width: 120px">
                        <option value="sch_list_gb_conf_no">승인 번호</option>
                        <option value="sch_list_gb_card_no">카드 번호</option>
                        <option value="sch_list_gb_conf_amt">승인 금액</option>
                      </select>
                      <input type="text" class="form-control form-control-sm me-1" id="sch_list_gb_val" name="sch_list_gb_val" style="width:100px" />                        
                      <button type="button" class="btn btn-primary btn-sm" id="btn_list_search" name="btn_list_search">조회</button> 
                    </div>
                  </div> 
                  <div class="col-sm-6">                                               
                  </div>
                  <div class="col-sm-2 text-end"> 
                    <button type="button" class="btn btn-primary btn-sm" id="btn_list_excel" name="btn_list_excel">Excel</button> 
                  </div>    
                </div> 
              </form>
            </div>
          </div>          
        </div>
        <div class="card-body pt-0 px-0" style="padding-top: 0px">
          <div class="table-responsive scrollbar">
            <table class="table table-striped table-sm fs-9 mb-0 selectable-table table-hover selectable" id="tbl_remit_list">  
              <thead>
                  <tr>
                    <th class="text-center">No</th> 
                    <th class="text-center">정산 번호</th> 
                    <th class="text-center">정산 상태</th>
                    <th class="text-center">매입사</th>
                    <th class="text-center">카드번호</th>
                    <th class="text-center">카드유형</th>
                    <th class="text-center">구분</th>
                    <th class="text-center">승인번호</th>
                    <th class="text-center">승인일시</th>
                    <th class="text-center">입금예정일</th>
                    <th class="text-center">승인금액</th>                    
                    <th class="text-center">카드수수료</th>
                    <th class="text-center">입금예정액</th>
                    <th class="text-center">서비스수수료</th>
                    <th class="text-center">정산 원금</th>
                    <th class="text-center">여신수수료</th>
                    <th class="text-center">송금예정액</th>
                    <th class="text-center">비고</th>
                  </tr>  
              </thead>
              <tbody class="list"></tbody>
            </table>
          </div>
        </div>        
      </div>     
    </div>    
  </div>

  <div class="modal fade" id="modal_sub_recv_list" tabindex="-1" aria-labelledby="unprocessedModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl"> <!-- Changed modal-lg to modal-xl for larger size -->
      <div class="modal-content">
        <form class="needs-validation" novalidate="" id="frm_modal_sub_recv" name="frm_modal_sub_recv" onsubmit="return false;">           
          <input id="sch_sub_recv_remit_no" type="hidden" name="sch_sub_recv_remit_no"/> 
          <div class="modal-header">
            <h5 class="modal-title">Risk Check</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body"> 
            <div class="table-responsive scrollbar">
              <table class="table table-striped table-sm fs-9 mb-0 selectable-table table-hover selectable" id="tbl_sub_recv_list">  
                <thead>
                    <tr>
                      <th class="text-center">차감번호</th> 
                      <th class="text-center">차감 사유</th>
                      <th class="text-center">진행상태</th>
                      <th class="text-center">발생금액</th>   
                      <th class="text-center">차감-당회</th>   
                      <th class="text-center">미수금액</th>   
                      <th class="text-center">메모</th>   
                    </tr>   
                </thead>
                <tbody class="list"></tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" aria-label="모달 닫기">닫기</button>
          </div>          
        </form>
      </div>
    </div>
  </div>
</html>
