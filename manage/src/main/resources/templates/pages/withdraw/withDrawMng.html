<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/default}" layout:fragment="Content">
  <head>
    <title>ì‚¬ì „ì •ì‚° ê´€ë¦¬</title>
    <script src="/vendors/tinymce/tinymce.min.js"></script>
    <script src="/vendors/datatables.net/dataTables.min.js"></script>
    <script src="/vendors/datatables.net-bs5/dataTables.bootstrap5.min.js"></script>
    <script src="/vendors/datatables.net-fixedcolumns/dataTables.fixedColumns.min.js"></script>
    <script src="/vendors/dropzone/dropzone-min.js"></script>
    <script src="/js/jquery.form.js"></script> 
    <link rel="stylesheet" href="/vendors/datatables.net-bs5/dataTables.bootstrap5.min.css" />    
    <!-- DataTables Select CSS ì¶”ê°€ -->
    <link rel="stylesheet" href="/css/custom-salesm.css" />

    <script th:inline="none">      
      $(document).ready(function () {           
        $('#frm_sch').onLoadFunction();      
        $('#frm_sch_card').onLoadFunction();      
        $('#frm_sch_list').onLoadFunction();      

        callAjax('/common/getCreditCorpList', "", fn_corp_list_setting);
        function fn_corp_list_setting(data) {
          codeSetting('CORP_CD', data.data, '#sch_corp_no', 'ì—¬ì‹ ì‚¬', '', ''); 
        }

        callAjax('/common/getAgencyList', "", fn_agency_list_setting);
        function fn_agency_list_setting(data) {
          codeSetting('AGENCY_CD', data.data, '#sch_agency_cd', 'ëŒ€ë¦¬ì ', '', ''); 
        }  

        callAjax('/common/totalCodelist', "code_grp_cd=('WD_STATUS') AND CODE LIKE 'W%' AND CHK_CD2 = 'M'", fn_wd_status_setting);      
        function fn_wd_status_setting(data) {
          codeSetting('WD_STATUS', data.data, '#change_wd_status', 'ì§„í–‰ìƒíƒœ', '', '');  
        }

        callAjax('/common/totalCodelist', "code_grp_cd=('VAN_CD')", fn_corp_van_setting);      
        function fn_corp_van_setting(data) {
          codeSetting('VAN_CD', data.data, '#sch_list_van', 'VAN', '', '');  
        }

        // Set default values for sch_reg_sdt and sch_reg_edt
        var toDay = returnDate('today');
        $('#sch_work_date').val(toDay);
        $('#change_work_date').val(toDay);

        $('#btn_search').click(function () {   
          fn_default_clear();
          tbl_wd_summ.ajax.reload();
        });  

        $('#btn_list_search').click(function () {   
          tbl_wd_resv_list.ajax.reload();
        }); 

        var tbl_wd_summ = $('#tbl_wd_summ').DataTable({
            processing: true,
            serverSide: true,
            select: true, // select ì˜µì…˜ì€ DataTables Select í™•ì¥ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì²´í¬ë°•ìŠ¤ ë™ì‘ê³¼ ì§ì ‘ ê´€ë ¨ì€ ì ìŠµë‹ˆë‹¤.
            responsive: true,
            ajax: {
                url: '/withdraw/withdraw/wdMng/wdSummary',
                contentType: 'application/json',
                dataType: 'JSON',
                type: 'POST',
                data: function (postData) {
                    var formData = $('#frm_sch').serializeObject(); // serializeObjectëŠ” jQuery í”ŒëŸ¬ê·¸ì¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    for (var key in formData) {
                        postData[key] = formData[key];
                    }
                    return JSON.stringify(postData); 
                    // Object.assign(postData, formData);
                    // return JSON.stringify(postData);
                },
                dataSrc: function (json) {
                    // totalSummary ì €ì¥
                    totalSumm = json.totalSumm || {};
                    return json.data;
                },
                // ì„œë²„ ì—ëŸ¬ ì²˜ë¦¬ ë“± ì¶”ê°€ ê°€ëŠ¥
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error("DataTables Ajax Error: ", textStatus, errorThrown);
                    // ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ë“±
                }
            },
            columns: [
                {
                    data: 'chain_no',
                    render: function(data, type, row) {
                        // ê° í–‰ì˜ ì²´í¬ë°•ìŠ¤ ìƒì„±. ê³ ìœ  ê°’(ì—¬ê¸°ì„œëŠ” chain_no)ì„ valueë¡œ ì‚¬ìš©
                        return '<input type="checkbox" class="form-check-input row-checkbox" value="' + data + '">';
                    },
                    orderable: false,
                    className: 'text-center dt-body-center' // DataTables 1.10+ ê¶Œì¥ í´ë˜ìŠ¤
                }
                , { data: 'chain_nm' }
                , { 
                  data: null,
                  render: function(data, type, row) {
                  let avgColor = '', predayColor = '';
            
                  under50 = 'background-color:#ff4d4f;color:#fff;'; // ë¶‰ì€ ê³„ì—´
                  under60 = 'background-color:#ffa940;color:#fff;'; // ì˜¤ë Œì§€ 
                  avgValue = row.rate_per_avg != null ? row.rate_per_avg : 0;
                  predayValue = row.rate_per_preday != null ? row.rate_per_preday : 0;

                  if (avgValue <= 50) avgColor = under50;
                  else if (avgValue <= 60) avgColor =under60;
                  if (predayValue <= 50) predayColor = under50;
                  else if (predayValue <= 60) predayColor = under60;
                  return '<span style="padding:2px 6px;border-radius:4px;' + avgColor + '">' + avgValue + '%</span>' 
                    + ' / <span style="padding:2px 6px;border-radius:4px;' + predayColor + '">' + predayValue + '%</span>';
                  }
                }
                // , { data: 'risk_grade' }
                , { data: 'conf_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
                , { data: 'conf_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
                , { data: 'cncl_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
                , { data: 'cncl_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
                , { data: 'remit_conf_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') }
                , { data: 'remit_conf_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') }                
                , {
                  data: 'error_cnt',
                  render: function(data, type, row) {
                    if (data > 0) {
                      return '<span style="color: red; font-weight: bold; font-size: 14px;">' + data + '</span>';
                    }
                    return data;
                  }
                },
            ],
            columnDefs: [
                { targets: 0, width: '40px', className: 'text-center dt-body-center' }, // ì¤‘ì•™ ì •ë ¬ í™•ì¸
                { targets: 1, width: '130px', className: 'text-left px-1' },
                { targets: 2, width: '100px', className: 'text-right px-1 dt-body-center' }, // DataTables ê¶Œì¥ í´ë˜ìŠ¤
                { targets: 3, width: '80px', className: 'text-right px-1 dt-body-right' }, // ìˆ«ì ë°ì´í„°ëŠ” ì˜¤ë¥¸ìª½ ì •ë ¬ì´ ì¼ë°˜ì 
                { targets: 4, width: '110px', className: 'text-right px-1 dt-body-right' },
                { targets: 5, width: '80px', className: 'text-right px-1 dt-body-right' },
                { targets: 6, width: '110px', className: 'text-right px-1 dt-body-right' },
                { targets: 7, width: '80px', className: 'text-right px-1 dt-body-right' },
                { targets: 8, width: '110px', className: 'text-right px-1 dt-body-right' },
                { targets: 9, width: '80px', className: 'text-right px-1 dt-body-right' }
            ],
            order: [[1, 'desc']], // ê¸°ë³¸ ì •ë ¬ ì„¤ì •
            paging: true,
            lengthChange: false,
            searching: false,
            ordering: true,
            info: false, // í•„ìš”ì— ë”°ë¼ trueë¡œ ë³€ê²½
            autoWidth: false,
            // responsive: true, // ì´ë¯¸ ìœ„ì—ì„œ ì„¤ì •ë¨
            // scrollCollapse: true,
            scrollY: '300px',
            pageLength: 20,
            language: {
                emptyTable: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
                zeroRecords: 'ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
                loadingRecords: 'ë¡œë”©ì¤‘...',
                processing: '<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">ì²˜ë¦¬ì¤‘...</span></div>', // ë¡œë”©/ì²˜ë¦¬ì¤‘ ì‹œê°ì  í‘œì‹œ ê°œì„ 
            },
            footerCallback: function (row, data, start, end, display) {
                var api = this.api();
                const renderNumber = $.fn.dataTable.render.number(',', '.', 0, '').display;
                const colMap = {
                    3: 'conf_cnt',
                    4: 'conf_amt',
                    5: 'cncl_cnt',
                    6: 'cncl_amt',
                    7: 'remit_conf_cnt',
                    8: 'remit_conf_amt',
                    9: 'error_cnt',
                };

                Object.entries(colMap).forEach(([colIdx, key]) => {
                    const footer = api.column(Number(colIdx)).footer();
                    if (footer) {
                        const val = totalSumm[key] || 0;
                        $(footer).html(renderNumber(val));
                    }
                });

                // ê¸°íƒ€ í‘¸í„° ì„¤ì •
                // $(api.column(0).footer()).html('');
                // $(api.column(1).footer()).html('í•©ê³„:');
                // $(api.column(2).footer()).html('');
            },
            // =============================================================
            // ì¤‘ìš”: í…Œì´ë¸”ì´ ë‹¤ì‹œ ê·¸ë ¤ì§ˆ ë•Œë§ˆë‹¤ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
            // =============================================================
            drawCallback: function( settings ) {
                // 1. í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì´ˆê¸°í™” (ì„ íƒ ì‚¬í•­: í˜ì´ì§€ ë„˜ê¸¸ ë•Œë§ˆë‹¤ ì´ˆê¸°í™”í• ì§€ ê²°ì •)
                // $('#check_all').prop('checked', false); // í•„ìš”í•˜ë‹¤ë©´ ì£¼ì„ í•´ì œ

                // 2. í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  í–‰ ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì—¬ í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateCheckAllState();
            }
        });

        // --- ì „ì²´ ì„ íƒ/í•´ì œ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ---
        $('#check_all').on('click', function(){
            var isChecked = this.checked;
            // í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  í–‰ ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì•„ì„œ ìƒíƒœ ë³€ê²½
            tbl_wd_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox').prop('checked', isChecked);
        });

        // --- ê° í–‰ì˜ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©) ---
        $('#tbl_wd_summ tbody').on('click', '.row-checkbox', function(){
            // ê°œë³„ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ 'ì „ì²´ ì„ íƒ' ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateCheckAllState();
        });

        // --- 'ì „ì²´ ì„ íƒ' ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateCheckAllState() {
            var $rowCheckboxes = tbl_wd_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox');
            var totalCheckboxes = $rowCheckboxes.length;
            var checkedCheckboxes = $rowCheckboxes.filter(':checked').length;

            // ëª¨ë“  ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
            var allChecked = totalCheckboxes > 0 && totalCheckboxes === checkedCheckboxes;
            $('#check_all').prop('checked', allChecked);

            // í•˜ë‚˜ë¼ë„ ì„ íƒëœ ê²½ìš° vs ëª¨ë‘ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° (ì„ íƒ ì‚¬í•­: indeterminate ìƒíƒœ êµ¬í˜„)
            if (checkedCheckboxes > 0 && checkedCheckboxes < totalCheckboxes) {
                $('#check_all').prop('indeterminate', true); // ì¼ë¶€ë§Œ ì„ íƒë˜ì—ˆì„ ë•Œ ì¤‘ê°„ ìƒíƒœ í‘œì‹œ
            } else {
                $('#check_all').prop('indeterminate', false);
            }
        }

        // serializeObject í•¨ìˆ˜ê°€ ì—†ë‹¤ë©´ ì¶”ê°€ (ê°„ë‹¨ ë²„ì „)
        if (typeof $.fn.serializeObject !== 'function') {
            $.fn.serializeObject = function() {
                var o = {};
                var a = this.serializeArray();
                $.each(a, function() {
                    if (o[this.name]) {
                        if (!o[this.name].push) {
                            o[this.name] = [o[this.name]];
                        }
                        o[this.name].push(this.value || '');
                    } else {
                        o[this.name] = this.value || '';
                    }
                });
                return o;
            };
        } 
 
        $('#tbl_wd_summ').on('click', 'tr', function (e) {          
          if ($(this).hasClass('selected')) {
              $(this).removeClass('selected');
          } else {
              tbl_wd_summ.$('tr.selected').removeClass('selected');
              $(this).addClass('selected');
          } 
          // ìˆ˜ì •ëœ ë¶€ë¶„: í´ë¦­ëœ ì…€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          var clickedCell = $(e.target).closest('td');
          var clickedColumnIndex = clickedCell.index();
          
          var row = tbl_wd_summ.row(this).data();
          // if (clickedColumnIndex == 2 && row.risk_grade > 0) {
          //     // Show modal_risk              
          //     $('#risk_chain_no').val(row.chain_no);              
          //     $('#modal_risk').modal('show');   
          //     $('#tbl_risk_list').DataTable().ajax.reload(); 
          // }

          if (clickedColumnIndex == 9 && row.error_cnt > 0) { 
            $('#sch_list_wd_status_n').prop('checked', true);           
          }
          
          $('#frm_sch_card')[0].reset();   
          // $('#frm_sch_list')[0].reset();
          
          $('#sch_card_chain_no').val(row.chain_no);
          $('#sch_list_chain_no').val(row.chain_no);   // list ê²€ìƒ‰ ì¡°ê±´
          $('#sch_risk_chain_no').val(row.chain_no);   // risk ê²€ìƒ‰ ì¡°ê±´

          $('#sch_card_work_date').val($('#sch_work_date').val());   // ì¹´ë“œ ì‘ì—…ì¼ ì„¤ì •
          $('#sch_list_work_date').val($('#sch_work_date').val());   // risk ì‘ì—…ì¼ ì„¤ì •           

          $('#tot_conf_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.tot_amt));
          $('#card_fee_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.card_fee_amt));
          $('#card_resv_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.card_resv_amt));
          $('#svc_fee_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.svc_fee_amt));      
          $('#crd_fee_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.crd_fee_amt));
          $('#wd_base_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.wd_base_amt));

          if (row.sub_amt > 0) {
            $('#sub_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.sub_amt))
              .css({ 'color': 'red', 'font-weight': 'bold' });
          } else {
            $('#sub_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.sub_amt))
              .css({ 'color': '', 'font-weight': '' });
          }
          
          $('#exc_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.exc_amt));
          if (row.remit_amt > 0) {
            $('#remit_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.remit_amt))
              .css({ 'color': 'blue', 'font-weight': 'bold' });
          } else if (row.remit_amt < 0) {
            $('#remit_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.remit_amt))
              .css({ 'color': 'red', 'font-weight': 'bold' });
          } else {
            $('#remit_amt').val($.fn.dataTable.render.number(',', '.', 0, '').display(row.remit_amt))
              .css({ 'color': '', 'font-weight': '' });
          }
          $('#tbl_card_summ').DataTable().ajax.reload(); 
          if ($('#sch_list_chain_no').val() && $('#sch_list_work_date').val()) {
            tbl_wd_resv_list.ajax.reload();
          } 
          
          var tmpForm = {
            sch_chain_no : $('#sch_list_chain_no').val(),
          }
          callAjax('/common/getChainVanList', tmpForm, fn_corp_van_setting);   

        });

        $('#btn_remit').click(function () {
          var selectedChainNos = [];
          // Iterate through checked checkboxes in the current page
          tbl_wd_summ.rows({ page: 'current' }).nodes().to$().find('.row-checkbox:checked').each(function () {
            selectedChainNos.push($(this).val());
          });
          
          var dataParam ="";
          if ($('#remit_all').is(':checked')) {  
            if (!confirm("ëª¨ë‘ ì¶œê¸ˆ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {              
              return;
            }
            dataParam ={
              workDate : $('#sch_work_date').val(),
              chainNo : 'ALL',
            }
          } else {
            if (selectedChainNos.length === 0) {
              alert('ì¶œê¸ˆ ì²˜ë¦¬í•  ê°€ë§¹ì ì„ ì„ íƒí•˜ì„¸ìš”.');
              return;
            }
            dataParam ={              
              workDate : $('#sch_work_date').val(),
              chainNo : selectedChainNos.join(','),
            }  
          } 
  
          ConfirmdialogToAjax("execute","/withdraw/withdraw/wdMng/procRemitMain", dataParam, fn_remit_result); 
        });
         
        function fn_remit_result(data){ 
          Swal.fire({
            title: 'ì„±ê³µ',
            text: 'ì‘ì—…ì„ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.',
            icon: 'success'
          });
          fn_default_clear();
          tbl_wd_summ.ajax.reload();
        }

        function fn_default_clear(){
          // $('#frm_sch')[0].reset();
          $('#frm_sch_card')[0].reset();   
          $('#frm_sch_list')[0].reset();
          $('#sch_card_chain_no').val('');
          $('#sch_card_work_date').val('');

          $('#sch_list_chain_no').val('');
          $('#sch_list_work_date').val('');
          $('#sch_list_card_acq').val('');  
          tbl_card_summ.ajax.reload(); 
          tbl_wd_resv_list.ajax.reload();  
        }

        // sch_list_wd_status ë¼ë””ì˜¤ ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        $('input[name="sch_list_wd_status"]').on('change', function () {
          // alert('ê²€ìƒ‰ ì¡°ê±´ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
          tbl_wd_resv_list.ajax.reload();          
        });
        
        var tbl_card_summ = $('#tbl_card_summ').DataTable({
          processing: true,
          serverSide: true,
          select: true,
          responsive: true,
          ajax: {
            url: '/withdraw/withdraw/wdMng/wdCardSummary',
            contentType: 'application/json',
            dataType: 'JSON',
            type: 'POST',
            data: function (postData) {
              formData = $('#frm_sch_card').serializeObject(); 
              Object.assign(postData, formData);
              return JSON.stringify(postData);
            },
          },
          columns: [
            { data: 'card_acq_nm' },
            { data: 'conf_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'conf_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'cncl_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'cncl_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'tot_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'tot_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
          ],
          columnDefs: [            
            { targets: 0, width: '120px', className: 'text-left' },
            { targets: 1, width: '90px', className: 'text-end' },
            { targets: 2, width: '130px', className: 'text-end' },
            { targets: 3, width: '90px', className: 'text-end' },
            { targets: 4, width: '130px', className: 'text-end' },
            { targets: 5, width: '90px', className: 'text-end' },
            { targets: 6, width: '130px', className: 'text-end' },
          ],
          order: [[1, 'asc']],
          paging: false,
          lengthChange: false,
          searching: false,
          ordering: true,
          autoWidth: false,
          responsive: true,
          // scrollCollapse: true,
          // pageLength: 15,
          scrollY: '315px',
          info: false,
          language: {
            emptyTable: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
            search: 'ê²€ìƒ‰:',
            zeroRecords: 'ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
            loadingRecords: 'ë¡œë”©ì¤‘...',
            processing: 'ì²˜ë¦¬ì¤‘...',
          },
        });

        var tbl_wd_resv_list = $('#tbl_wd_resv_list').DataTable({
          processing: true,
          serverSide: true,
          select: true,
          responsive: true,
          ajax: {
            url: '/withdraw/withdraw/wdMng/wdResvList',
            contentType: 'application/json',
            dataType: 'JSON',
            type: 'POST',
            data: function (postData) {
              formData = $('#frm_sch_list').serializeObject();
              Object.assign(postData, formData);
              return JSON.stringify(postData);
            },
          }, 
          columns: [
            {
                data: null,
                render: function (data, type, row, meta) {
                  return meta.row + meta.settings._iDisplayStart + 1;
                },                    
            }, 
            {
                    data: 'wd_no',
                    render: function(data, type, row) {
                        // ê° í–‰ì˜ ì²´í¬ë°•ìŠ¤ ìƒì„±. ê³ ìœ  ê°’(ì—¬ê¸°ì„œëŠ” wd_no)ì„ valueë¡œ ì‚¬ìš©
                        return '<input type="checkbox" class="form-check-input row-checkbox" value="' + data + '">';
                    },
                    orderable: false,
                    className: 'text-center dt-body-center' // DataTables 1.10+ ê¶Œì¥ í´ë˜ìŠ¤
            },
            { data: 'wd_no' },
            { data: 'wd_status_nm' },
            { data: 'van_cd_nm' },
            { data: 'card_acq_nm' },
            { data: 'card_no' },
            { data: 'card_type_nm' },
            { data: 'conf_gb_nm' },
            { data: 'conf_no' },
            { data: 'conf_dttm' },
            { data: 'card_resv_date' },
            { data: 'conf_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'card_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'card_resv_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'svc_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'wd_base_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'crd_fee_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'remit_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
            { data: 'wd_memo' },
          ],
          columnDefs: [
            { targets: 0, width: '60px', className: 'text-center' },
            { targets: 1, width: '40px', className: 'text-center' },
            { targets: 2, width: '130px', className: 'text-left' },
            { targets: 3, width: '100px', className: 'text-left' },
            { targets: 4, width: '90px', className: 'text-center' },
            { targets: 5, width: '90px', className: 'text-center' },
            { targets: 6, width: '150px', className: 'text-center' },
            { targets: 7, width: '80px', className: 'text-center' },
            { targets: 8, width: '100px', className: 'text-center' },
            { targets: 9, width: '120px', className: 'text-center' },
            { targets: 10, width: '160px', className: 'text-center' },
            { targets: 11, width: '120px', className: 'text-center' },
            { targets: 12, width: '100px', className: 'text-end' },
            { targets: 13, width: '120px', className: 'text-end' },
            { targets: 14, width: '100px', className: 'text-end' },
            { targets: 15, width: '120px', className: 'text-end' },
            { targets: 16, width: '100px', className: 'text-end' },
            { targets: 17, width: '120px', className: 'text-end' },
            { targets: 18, width: '120px', className: 'text-end' },
            { targets: 19, width: '100px', className: 'text-center' },            
          ],
          order: [[2, 'desc']],
          paging: true,
          lengthChange: false,
          searching: false,
          ordering: true,
          autoWidth: true,
          responsive: true,
          scrollCollapse: true,
          pageLength: 100,
          scrollY: '580px',
          info: false,
          language: {
            emptyTable: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
            search: 'ê²€ìƒ‰:',
            zeroRecords: 'ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
            loadingRecords: 'ë¡œë”©ì¤‘...',
            processing: 'ì²˜ë¦¬ì¤‘...',
          },
          
          // =============================================================
            // ì¤‘ìš”: í…Œì´ë¸”ì´ ë‹¤ì‹œ ê·¸ë ¤ì§ˆ ë•Œë§ˆë‹¤ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
            // =============================================================
          drawCallback: function( settings ) {
              // 1. í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì´ˆê¸°í™” (ì„ íƒ ì‚¬í•­: í˜ì´ì§€ ë„˜ê¸¸ ë•Œë§ˆë‹¤ ì´ˆê¸°í™”í• ì§€ ê²°ì •)
              // $('#check_all_list').prop('checked', false); // í•„ìš”í•˜ë‹¤ë©´ ì£¼ì„ í•´ì œ

              // 2. í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  í–‰ ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì—¬ í—¤ë” ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
              updateCheckAllListState();
          }
        });

        // --- ì „ì²´ ì„ íƒ/í•´ì œ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ---
        $('#check_all_list').on('click', function(){
            var isChecked = this.checked;
            // í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  í–‰ ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì•„ì„œ ìƒíƒœ ë³€ê²½
            tbl_wd_resv_list.rows({ page: 'current' }).nodes().to$().find('.row-checkbox').prop('checked', isChecked);
        });

        // --- ê° í–‰ì˜ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©) ---
        $('#tbl_wd_resv_list tbody').on('click', '.row-checkbox', function(){
            // ê°œë³„ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ 'ì „ì²´ ì„ íƒ' ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateCheckAllListState();
        });

        $('#tbl_wd_resv_list').on('click', 'tr', function () {            
          if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
            $(this).find('.row-checkbox').prop('checked', false);
          } else {
            $(this).addClass('selected');
            $(this).find('.row-checkbox').prop('checked', true);
          }
        });

        // --- 'ì „ì²´ ì„ íƒ' ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateCheckAllListState() {
            var $rowCheckboxes = tbl_wd_resv_list.rows({ page: 'current' }).nodes().to$().find('.row-checkbox');
            var totalCheckboxes = $rowCheckboxes.length;
            var checkedCheckboxes = $rowCheckboxes.filter(':checked').length;

            // ëª¨ë“  ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
            var allChecked = totalCheckboxes > 0 && totalCheckboxes === checkedCheckboxes;
            $('#check_all_list').prop('checked', allChecked);

            // í•˜ë‚˜ë¼ë„ ì„ íƒëœ ê²½ìš° vs ëª¨ë‘ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° (ì„ íƒ ì‚¬í•­: indeterminate ìƒíƒœ êµ¬í˜„)
            if (checkedCheckboxes > 0 && checkedCheckboxes < totalCheckboxes) {
                $('#check_all_list').prop('indeterminate', true); // ì¼ë¶€ë§Œ ì„ íƒë˜ì—ˆì„ ë•Œ ì¤‘ê°„ ìƒíƒœ í‘œì‹œ
            } else {
                $('#check_all_list').prop('indeterminate', false);
            }
        }
        
        $('#tbl_card_summ').on('click', 'tr', function () {            
          if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
          } else {
            $(this).addClass('selected');
          }

          var row = tbl_card_summ.row(this).data();
          var currentValue = $('#sch_list_card_acq').val();
          var newValue = row.card_acq;
          
          if (currentValue.includes(newValue)) {
            // Remove the value if it already exists
            var updatedValue = currentValue.split(',').filter(function (value) {
              return value !== newValue;
            }).join(',');
            $('#sch_list_card_acq').val(updatedValue);
          } else {
            // Add the value if it doesn't exist
            if (currentValue) {
              $('#sch_list_card_acq').val(currentValue + ',' + newValue);
            } else {
              $('#sch_list_card_acq').val(newValue);
            }
          } 

          if ($('#sch_list_chain_no').val() && $('#sch_list_work_date').val()) {
            tbl_wd_resv_list.ajax.reload();
          } 
        });   


        // Change event for change_gb dropdown
        $('#change_gb').on('change', function () {
          var selectedValue = $(this).val();
          if (selectedValue === 'WORK_DATE') {
            $('#div_work_date').show();
            $('#div_wd_status').hide();
          } else if (selectedValue === 'WD_STATUS') {
            $('#div_work_date').hide();
            $('#div_wd_status').show();
          }
        });
 
        $('#btn_list_change').click(function () {          
          var selectedWdNo = [];
            // Iterate through checked checkboxes in the current page
          tbl_wd_resv_list.rows({ page: 'current' }).nodes().to$().find('.row-checkbox:checked').each(function () {
          selectedWdNo.push($(this).val());
          });

          if (selectedWdNo.length === 0) {
            alert('ë³€ê²½ ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
            return;
          }

          var dataParam = {
            wdNo: selectedWdNo.join(','),
            wdStatus: $('#change_wd_status').val(),
            workDate: $('#change_work_date').val(),
          };

          var changeGb = $('#change_gb').val();
          if (changeGb === 'WORK_DATE') {
            var workDate = $('#change_work_date').val();
            if (!workDate) {
              alert('ë³€ê²½ ì‘ì—…ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
              return;
            }
            if (workDate < toDay ){
              alert('ë³€ê²½ì¼ì€ ê¸ˆì¼ ì´í›„ë¡œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
              return;
            }
            
            ConfirmdialogToAjax("execute", "/withdraw/withdraw/wdMng/changeWorkDate", dataParam, fn_change_result);
          } else if (changeGb === 'WD_STATUS') {
            var wdStatus = $('#change_wd_status').val();
            if (!wdStatus) {
              alert('ì§„í–‰ ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”.');
              return;
            }
            ConfirmdialogToAjax("execute", "/withdraw/withdraw/wdMng/changeWdStatus", dataParam, fn_change_result);
          }   
        });

        function fn_change_result(data){
          swal('ì„±ê³µ', 'ì‘ì—…ì„ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.', 'success');
          fn_default_clear();
          tbl_wd_summ.ajax.reload();
        }
        
        // Excel download button click event
        $('#btn_list_excel').click(function () {
          var formData = $('#frm_sch_list').serializeObject();
          $('#globalLoadingBar').show();
          $.ajax({
            url: '/withdraw/withdraw/wdMng/wdResvListExcel',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            xhrFields: {
              responseType: 'blob'
            },
            success: function (data, status, xhr) {              
              var blob = new Blob([data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              var link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download = 'ì •ì‚° ìƒì„¸ ë¦¬ìŠ¤íŠ¸.xlsx';
              link.click();
            },
            error: function (xhr, status, error) {
              alert('Excel download failed.');
            },
            complete: function () {
              // ğŸ”´ ë¡œë”©ë°” ìˆ¨ê¸°ê¸° (ì„±ê³µ/ì‹¤íŒ¨ ê´€ê³„ì—†ì´)
              $('#globalLoadingBar').hide();
            }
          });
        }); 

        $('#sub_amt').on('click', function () {
          var subAmtValue = parseFloat($(this).val().replace(/,/g, '')) || 0; // Remove commas and parse as float
          if (subAmtValue > 0) {
            $('#modal_sub').modal('show'); // Show the modal             
          }
        });

        // ëª¨ë‹¬ ì°½ í‘œì‹œë ë•Œ ì´ˆê¸°í™” ì²˜ë¦¬
        $('#modal_sub').on('shown.bs.modal', function() {  
          // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì²« ë²ˆì§¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œë¡œ ì´ë™          
          $(this).data('trigger-element', document.activeElement);          
          
          if ($.fn.DataTable.isDataTable('#tbl_sub_list')) {
            $('#tbl_sub_list').DataTable().destroy();
          }          
          
          $('#tbl_sub_list').DataTable({
            processing: true,
            serverSide: true,
            select: true,
            responsive: true,
            ajax: {
              url: '/withdraw/subtract/subMng/chainWdSubList',
              contentType: 'application/json',
              dataType: 'JSON',
              type: 'POST',
              data: function (postData) {
                var formData = { 
                    sch_chain_no: $('#sch_card_chain_no').val()
                    , sch_unissu : "Y" 
                  };
                Object.assign(postData, formData);
                return JSON.stringify(postData);
              },
            },
            columns: [
              { data: 'sub_code_nm' },
              { data: 'reg_date' },
              { data: 'occur_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
              { data: 'recv_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
              { data: 'remain_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
              { data: 'sub_memo' },
            ],
            columnDefs: [
              { targets: 0, width: '150px', className: 'text-center' },
              { targets: 1, width: '100px', className: 'text-center' },
              { targets: 2, width: '120px', className: 'text-end' },
              { targets: 3, width: '120px', className: 'text-end' },
              { targets: 4, width: '120px', className: 'text-end' },
              { targets: 5, width: '300px', className: 'text-left' },
            ],
            order: [[1, 'desc']],
            paging: true,
            lengthChange: false,
            searching: false,
            ordering: true,
            autoWidth: false,
            responsive: true,
            scrollCollapse: true,
            pageLength: 10,
            scrollY: '400px',
            info: false,
            language: {
              emptyTable: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
              zeroRecords: 'ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
              loadingRecords: 'ë¡œë”©ì¤‘...',
              processing: 'ì²˜ë¦¬ì¤‘...',
            },
          });
          // ì²« ë²ˆì§¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œë¡œ ì´ë™
          $(this).find('button:not([disabled]), input:not([disabled])').first().focus();      
        });

        // ëª¨ë‹¬ì´ ë‹«í ë•Œ í¬ì»¤ìŠ¤ ë³µì›
        $('#modal_sub').on('hidden.bs.modal', function() {
          var triggerElement = $(this).data('trigger-element');
          if (triggerElement) {
            $(triggerElement).focus();
          }  
          return true; // ëª¨ë‹¬ ë‹«ê¸° í—ˆìš©
        });

        $('#exc_amt').on('click', function () {
          var excAmtValue = parseFloat($(this).val().replace(/,/g, '')) || 0; // Remove commas and parse as float
          if (excAmtValue > 0) {
            $('#modal_exc').modal('show'); // Show the modal            
          }
        });

        // ëª¨ë‹¬ ì°½ í‘œì‹œë ë•Œ ì´ˆê¸°í™” ì²˜ë¦¬
        $('#modal_exc').on('shown.bs.modal', function() {  
          // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì²« ë²ˆì§¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œë¡œ ì´ë™          
          $(this).data('trigger-element', document.activeElement);
          if ($.fn.DataTable.isDataTable('#tbl_exc_list')) {
            $('#tbl_exc_list').DataTable().destroy();
          }          
          
          $('#tbl_exc_list').DataTable({
            processing: true,
            serverSide: true,
            select: true,
            responsive: true,
            ajax: {
                url: '/deposit/exceed/excMng/chainExcResvList',
                contentType: 'application/json',
                dataType: 'JSON',
                type: 'POST',
                data: function (postData) {
                  var formData = { sch_chain_no: $('#sch_card_chain_no').val() };
                  Object.assign(postData, formData);
                  return JSON.stringify(postData);
                },
              },
            columns: [
              { data: 'exc_code_nm' },
              { data: 'exc_date' },
              { data: 'occur_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
              { data: 'issue_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
              { data: 'remain_amt', render: $.fn.dataTable.render.number(',', '.', 0, '') },
              { data: 'exc_memo' },
            ],
            columnDefs: [
              { targets: 0, width: '150px', className: 'text-center' },
              { targets: 1, width: '100px', className: 'text-center' },
              { targets: 2, width: '120px', className: 'text-end' },
              { targets: 3, width: '120px', className: 'text-end' },
              { targets: 4, width: '120px', className: 'text-end' },
              { targets: 5, width: '300px', className: 'text-left' },
            ],
            order: [[1, 'desc']],
            paging: true,
            lengthChange: false,
            searching: false,
            ordering: true,
            autoWidth: false,
            responsive: true,
            scrollCollapse: true,
            pageLength: 10,
            scrollY: '400px',
            info: false,
            language: {
              emptyTable: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
              zeroRecords: 'ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
              loadingRecords: 'ë¡œë”©ì¤‘...',
              processing: 'ì²˜ë¦¬ì¤‘...',
            },
          });
          // ì²« ë²ˆì§¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œë¡œ ì´ë™
          $(this).find('button:not([disabled]), input:not([disabled])').first().focus();           
          // document.querySelector('body > :not(#modal_exc)').inert = true;
        });

        // ëª¨ë‹¬ì´ ë‹«í ë•Œ í¬ì»¤ìŠ¤ ë³µì›
        $('#modal_exc').on('hidden.bs.modal', function() {
          var triggerElement = $(this).data('trigger-element');
          if (triggerElement) {
            $(triggerElement).focus();
          } 
          // document.querySelector('body > :not(#modal_sub)').inert = false;
          return true; // ëª¨ë‹¬ ë‹«ê¸° í—ˆìš©
        });
        
        // ëª¨ë‹¬ ì°½ í‘œì‹œë ë•Œ ì´ˆê¸°í™” ì²˜ë¦¬
        $('#modal_risk').on('shown.bs.modal', function() {  
          // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì²« ë²ˆì§¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œë¡œ ì´ë™          
          $(this).data('trigger-element', document.activeElement);
          if ($.fn.DataTable.isDataTable('#tbl_risk_list')) {
            $('#tbl_risk_list').DataTable().destroy();
          }          
          // ìƒˆë¡œ ì´ˆê¸°í™”
          $('#tbl_risk_list').DataTable({ 
              processing: true,
              serverSide: true,
              select: true,
              responsive: true,
              ajax: {
                url: '/withdraw/withdraw/wdMng/getRiskList',
                contentType: 'application/json',
                dataType: 'JSON',
                type: 'POST',
                data: function (postData) {
                  formData = $('#frm_risk').serializeObject();
                  Object.assign(postData, formData);
                  return JSON.stringify(postData);
                },
              },
              columns: [
                  { data: 'chain_no' },
                  { data: 'chain_nm' },
                  { data: 'proc_result' },
                  { data: 'un_proc_cnt', render: $.fn.dataTable.render.number(',', '.', 0, '') },  
              ],
              columnDefs: [
                  { targets: 0, width: '100px', className: 'text-left' },
                  { targets: 1, width: '120px', className: 'text-left' },
                  { targets: 2, width: '500px', className: 'text-left' },
                  { targets: 3, width: '100px', className: 'text-end' },
              ],
              order: [[1, 'desc']],
              paging: true,
              lengthChange: false,
              searching: false,
              ordering: true,
              autoWidth: false,
              responsive: true,
              scrollCollapse: true,
              pageLength: 20,
              scrollY: '380px',
              info: false,
              language: {
                emptyTable: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
                search: 'ê²€ìƒ‰:',
                zeroRecords: 'ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
                loadingRecords: 'ë¡œë”©ì¤‘...',
                processing: 'ì²˜ë¦¬ì¤‘...',
              },
          });
          // ì²« ë²ˆì§¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥ ìš”ì†Œë¡œ ì´ë™
          $(this).find('button:not([disabled]), input:not([disabled])').first().focus();        
          document.querySelector('body > :not(#modal_risk)').inert = true;   
        });
        
        // ëª¨ë‹¬ì´ ë‹«í ë•Œ í¬ì»¤ìŠ¤ ë³µì›
        $('#modal_risk').on('hidden.bs.modal', function() {
          // var triggerElement = $(this).data('trigger-element');
          // if (triggerElement) {
          //   $(triggerElement).focus();
          // } 
          // return true; // ëª¨ë‹¬ ë‹«ê¸° í—ˆìš©
          document.querySelector('body > :not(#tbl_exc_list)').inert = false;
        });          
      });
    </script>
  </head>
  <div class="content">     
    <div class="row g-1 mb-1">
      <div class="col-lg-7">
        <div class="card" style="height: 560px;">
          <div class="card-header">          
            <div class="row flex-between-end">
              <div class="col-lg-2 align-self-center">
                <h4 class="mb-0">ì‚¬ì „ ì •ì‚°</h4>
              </div>            
              <div class="col-lg-10">
                <form id="frm_sch" name="frm_sch" onsubmit="return false;" novalidate=""> 
                  <div class="row mb-0">
                    <div class="col-sm-12">
                      <div class="input-group input-group-sm mb-1">
                        <div class="col-sm-3">
                          <input class="form-control form-control-sm" id="sch_work_date" type="text" name="sch_work_date" istyle="date" maxlength="10" required />
                        </div>   
                        <select class="form-select form-control-sm me-1" id="sch_corp_no" name="sch_corp_no" style="width: 75px">
                          <option value="">ì—¬ì‹ ì‚¬</option>
                        </select>
                        <select class="form-select form-control-sm me-1" id="sch_agency_cd" name="sch_agency_cd" style="width: 75px">
                          <option value="">ëŒ€ë¦¬ì </option>
                        </select>
                        <!-- <select class="form-select form-control-sm me-1" id="schgb_chain" name="schgb_chain" style="width: 75px">
                          <option value="">ê°€ë§¹ì  ì •ë³´</option>
                          <option value="schgb_chain_nm">ê°€ë§¹ì  ëª…</option>
                          <option value="schgb_biz_no">ì‚¬ì—…ì ë²ˆí˜¸</option>
                        </select> -->
                        <input type="text" class="form-control form-control-sm me-1" id="schgb_chain_val" name="schgb_chain_val" style="width:100px" />
                        <button type="button" class="btn btn-primary btn-sm" id="btn_search" name="btn_search">ì¡°íšŒ</button>
                      </div>
                    </div> 
                  </div> 
                  <div class="row mb-0">
                    <div class="col-sm-8">
                      
                    </div>
                    <div class="col-sm-2">
                      <input type="checkbox" id="remit_all" class="form-check-input" />
                      <label for="remit_all" class="form-check-label">ëª¨ë‘ ì¶œê¸ˆ</label>
                    </div>
                    <div class="col-sm-2">
                      <button type="button" class="btn btn-success btn-sm" id="btn_remit" name="btn_remit">ì¶œê¸ˆ ì •ì‚° ì²˜ë¦¬</button>                      
                    </div>
                  </div>
                </form>                
              </div>
            </div>          
          </div>
          <div class="card-body pt-0 px-0" style="padding-top: 0px">
            <div class="table-responsive scrollbar">
              <table class="table table-striped table-sm fs-9 mb-0 selectable-table table-hover selectable" id="tbl_wd_summ">  
                <thead>
                  <tr>
                    <th class="text-center">
                        <input type="checkbox" id="check_all" class="form-check-input" />
                    </th>
                    <th class="text-center">ê°€ë§¹ì  ëª…</th>
                    <th class="text-center">í‰ê· /ì–´ì œ</th>
                    <th class="text-center">ìŠ¹ì¸ ê±´</th>
                    <th class="text-center">ìŠ¹ì¸ ê¸ˆì•¡</th>
                    <th class="text-center">ì·¨ì†Œ ê±´</th>
                    <th class="text-center">ì·¨ì†Œ ê¸ˆì•¡</th>                
                    <th class="text-center">ë§¤ì¶œ ê±´</th>
                    <th class="text-center">ë§¤ì¶œ ê¸ˆì•¡</th> 
                    <th class="text-center">ë¯¸í™•ì •</th> 
                  </tr>
                </thead>
                <tbody class="list"></tbody>
                <tfoot>
                  <tr>
                    <th colspan="3" class="text-center">ì´ê³„</th>
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th>
                    <th class="text-right px-2"></th> 
                    <th class="text-right px-2"></th>
                  </tr>
                </tfoot>
                
              </table>
            </div>
          </div>
        </div>      
      </div>
      <div class="col-lg-5">
        <div class="card" style="height: 560px;">    
          <div class="card-header">            
            <form id="frm_sch_card" name="frm_sch_card" onsubmit="return false;" novalidate="">
              <input class="form-control form-control-sm" id="sch_card_chain_no" type="hidden" name="sch_card_chain_no" readonly="readonly" />
              <input class="form-control form-control-sm" id="sch_card_work_date" type="hidden" name="sch_card_work_date"/>                
            
              <div class="row flex-between-end">
                <div class="row mb-1">
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="tot_conf_amt">ì´ ë§¤ì¶œê¸ˆì•¡</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="tot_conf_amt" type="text" name="tot_conf_amt" readonly />
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="card_fee_amt">ì¹´ë“œ ìˆ˜ìˆ˜ë£Œ</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="card_fee_amt" type="text" name="card_fee_amt" readonly/>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="card_resv_amt">ì…ê¸ˆ ì˜ˆì •ì•¡</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="card_resv_amt" type="text" name="card_resv_amt" readonly/>
                      </div>
                    </div>
                  </div>
                </div>  
                <div class="row mb-1">
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="svc_fee_amt">ìš´ì˜ ìˆ˜ìˆ˜ë£Œ</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="svc_fee_amt" type="text" name="svc_fee_amt" readonly/>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="crd_fee_amt">ì—¬ì‹  ìˆ˜ìˆ˜ë£Œ</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="crd_fee_amt" type="text" name="crd_fee_amt"  readonly />                           
                      </div>
                    </div>
                  </div>              
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="wd_base_amt">ì›    ê¸ˆ</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="wd_base_amt" type="text" name="wd_base_amt" readonly />
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mb-1">
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="sub_amt">ì°¨ ê° ì•¡</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="sub_amt" type="text" name="sub_amt" readonly/>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="exc_amt">ê³¼ ì… ê¸ˆ</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="exc_amt" type="text" name="exc_amt" readonly/>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="input-group input-group-sm mb-1">
                      <label class="col-sm-4 col-form-label col-form-label-sm" for="remit_amt">ì¶œê¸ˆ ì˜ˆì •ì•¡</label> 
                      <div class="col-sm-8">
                        <input class="form-control form-control-sm text-end bg-light" id="remit_amt" type="text" name="remit_amt" readonly />
                      </div>
                    </div>
                  </div>
                </div>     
              </div>
            </form>          
          </div>
          <div class="card-body pt-0 px-0" style="padding-top: 0px">
            <div class="table-responsive scrollbar">              
              <table class="table table-striped table-sm fs-9 mb-0 table-hover" id="tbl_card_summ">
                <thead>
                  <tr>  
                    <th class="text-center">ì¹´ë“œ(ë§¤ì…)ì‚¬</th>
                    <th class="text-center">ìŠ¹ì¸ ê±´</th>
                    <th class="text-center">ìŠ¹ì¸ ê¸ˆì•¡</th>
                    <th class="text-center">ì·¨ì†Œ ê±´</th>
                    <th class="text-center">ì·¨ì†Œ ê¸ˆì•¡</th>   
                    <th class="text-center">ì¶œê¸ˆ ê±´</th>
                    <th class="text-center">ì¶œê¸ˆ ê¸ˆì•¡</th>
                  </tr>
                </thead>
                <tbody class="list"></tbody>
              </table>
            </div>
          </div> 
        </div>      
      </div>        
    </div>     
    <div class="row g-1 mb-1">
      <div class="card">
        <div class="card-header"> 
          <div class="row flex-between-end">              
            <div class="col-lg-1 align-self-center">
              <h4 class="mb-0">ìƒì„¸ List</h4>
            </div>     
            <div class="col-lg-11">
              <form id="frm_sch_list" name="frm_sch_list" onsubmit="return false;" novalidate=""> 
                <input id="sch_list_chain_no"  type="hidden" name="sch_list_chain_no" />
                <input id="sch_list_chain_nm"  type="hidden" name="sch_list_chain_nm" />
                <input id="sch_list_work_date" type="hidden" name="sch_list_work_date"/>
                <input id="sch_list_card_acq"  type="hidden" name="sch_list_card_acq" />
                <div class="row mb-1">
                  <div class="col-sm-8">
                    <div class="input-group input-group-sm mb-1">
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sch_list_wd_status" id="sch_list_wd_status_all" value="A" checked>
                        <label class="form-check-label" for="sch_list_wd_status_all">ì „ì²´</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sch_list_wd_status" id="sch_list_wd_status_y" value="Y">
                        <label class="form-check-label" for="sch_list_wd_status_y">ì •ì‚°í™•ì •</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sch_list_wd_status" id="sch_list_wd_status_n" value="N">
                        <label class="form-check-label" for="sch_list_wd_status_n">ë¯¸í™•ì •</label>
                      </div>
                      <div class="col-sm-2">
                        <input class="form-control form-control-sm me-1" id="sch_list_conf_sdt" type="text" name="sch_list_conf_sdt" istyle="date" maxlength="10" required />
                      </div>   
                      <span class="input-group-text">~</span>
                      <div class="col-sm-2">
                        <input class="form-control form-control-sm me-1" id="sch_list_conf_edt" type="text" name="sch_list_conf_edt" istyle="date" maxlength="10" required />
                      </div>
                     
                      <select class="form-select form-control-sm me-1" id="sch_list_van" name="sch_list_van" style="width: 90px">
                        <option value="">ì „ì²´</option>
                      </select>                    
                      <select class="form-select form-control-sm me-1" id="sch_list_gb" name="sch_list_gb" style="width: 90px">
                        <option value="sch_list_gb_conf_no">ìŠ¹ì¸ ë²ˆí˜¸</option>
                        <option value="sch_list_gb_card_no">ì¹´ë“œ ë²ˆí˜¸</option>
                        <option value="sch_list_gb_conf_amt">ìŠ¹ì¸ ê¸ˆì•¡</option>
                      </select>
                      <input type="text" class="form-control form-control-sm me-1" id="sch_list_gb_conf_val" name="sch_list_gb_conf_val" style="width:90px" />                        
                      <button type="button" class="btn btn-primary btn-sm" id="btn_list_search" name="btn_list_search">ì¡°íšŒ</button> 
                    </div>
                  </div> 
                  <div class="col-sm-3">
                    <div class="input-group input-group-sm mb-1">
                      <!-- <label class="col-sm-2 col-form-label col-form-label-sm" for="change_wd_status">ë³€ê²½ ì²˜ë¦¬</label>                        -->
                      <div class="col-sm-4">
                        <select class="form-select form-control-sm me-1" id="change_gb" name="change_gb">
                          <option value="WD_STATUS">ìƒíƒœë³€ê²½</option>
                          <option value="WORK_DATE">ì¶œê¸ˆì¼</option>
                        </select>
                      </div>                      
                      <div class="col-sm-5" id="div_wd_status">
                        <select class="form-select form-control-sm me-1" id="change_wd_status" name="change_wd_status" >
                          <option value="">ì„ íƒ</option>   
                        </select>
                      </div>                      
                      <div class="col-sm-5" id="div_work_date" style="display:none;">
                        <input class="form-control form-control-sm me-1" id="change_work_date" type="text" name="change_work_date" istyle="date" maxlength="10" placeholder="ë³€ê²½ ì‘ì—…ì¼" />
                      </div>  
                      <div class="col-sm-2">
                        <button type="button" class="btn btn-info btn-sm" id="btn_list_change" name="btn_list_change">ë³€ê²½</button>
                      </div>
                    </div>                    
                  </div>
                  <div class="col-sm-1">
                    <div class="col-sm-1 text-end"> 
                      <button type="button" class="btn btn-primary btn-sm" id="btn_list_excel" name="btn_list_excel">Excel</button> 
                    </div>                           
                  </div>
                </div> 
              </form>
            </div>
          </div>          
        </div>
        <div class="card-body pt-0 px-0" style="padding-top: 0px">
          <div class="table-responsive scrollbar" style="overflow-x: auto; min-width: 1800px;">
            <table class="table table-striped table-sm fs-9 mb-0 selectable-table table-hover selectable table-bordered" id="tbl_wd_resv_list" style="min-width: 2160px; border-collapse: collapse;">
              <thead>
                  <tr>
                    <th class="text-center">No</th> 
                    <th class="text-center">
                      <input type="checkbox" id="check_all_list" class="form-check-input" />
                    </th>
                    <th class="text-center">ì •ì‚° ë²ˆí˜¸</th> 
                    <th class="text-center">ì •ì‚° ìƒíƒœ</th>
                    <th class="text-center">VAN</th>
                    <th class="text-center">ë§¤ì…ì‚¬</th>
                    <th class="text-center">ì¹´ë“œë²ˆí˜¸</th>
                    <th class="text-center">ì¹´ë“œìœ í˜•</th>
                    <th class="text-center">êµ¬ë¶„</th>
                    <th class="text-center">ìŠ¹ì¸ë²ˆí˜¸</th>
                    <th class="text-center">ìŠ¹ì¸ì¼ì‹œ</th>
                    <th class="text-center">ì…ê¸ˆì˜ˆì •ì¼</th>
                    <th class="text-center">ìŠ¹ì¸ê¸ˆì•¡</th>                    
                    <th class="text-center">ì¹´ë“œìˆ˜ìˆ˜ë£Œ</th>
                    <th class="text-center">ì…ê¸ˆì˜ˆì •ì•¡</th>
                    <th class="text-center">ì„œë¹„ìŠ¤ìˆ˜ìˆ˜ë£Œ</th>
                    <th class="text-center">ì •ì‚° ì›ê¸ˆ</th>
                    <th class="text-center">ì—¬ì‹ ìˆ˜ìˆ˜ë£Œ</th>
                    <th class="text-center">ì¶œê¸ˆì˜ˆì •ì•¡</th>
                    <th class="text-center">ë¹„ê³ </th>
                  </tr>  
              </thead>
              <tbody class="list"></tbody>
            </table>
          </div>
        </div>        
      </div>     
    </div>    
  </div>

  <div class="modal fade" id="modal_risk" tabindex="-1" >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <form class="needs-validation" novalidate="" id="frm_risk" name="frm_risk" onsubmit="return false;">           
          <input id="sch_risk_chain_no" type="hidden" name="sch_risk_chain_no"/> 
          <div class="modal-header">
            <h5 class="modal-title">Risk Check</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body"> 
            <div class="table-responsive scrollbar">
              <table class="table table-striped table-sm fs-9 mb-0 selectable-table table-hover selectable" id="tbl_risk_list">  
                <thead>
                    <tr>
                      <th class="text-center">ê°€ë§¹ì  ëª…</th> 
                      <th class="text-center">Risk</th>
                      <th class="text-center">ë‚´ìš©</th>
                      <th class="text-center">ë¯¸ì²˜ë¦¬ ê±´</th>   
                    </tr>   
                </thead>
                <tbody class="list"></tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <!-- <h6 class="text-start text-primary">â€»ë¯¸ì²˜ë¦¬ ë©”ì„¸ì§€ ë‚´ìš©ì— ëŒ€í•œ ì¡°ì¹˜ë¥¼ ë¨¼ì €í•œ í›„ ì ìš© ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</h6> -->
            <button class="btn btn-primary" id="btn_process" type="submit" aria-label="ì²˜ë¦¬">ì ìš©</button>
            <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" >ë‹«ê¸°</button>
          </div>          
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modal_sub" tabindex="-2" >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ì°¨ê° ë‚´ì—­</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body"> 
          <div class="table-responsive scrollbar">
            <table class="table table-striped table-sm fs-9 mb-0 table-hover" id="tbl_sub_list">
              <thead class="bg-200">
                <tr>
                  <th class="text-center" style="width: 150px;">ì°¨ê° ì½”ë“œëª…</th>
                  <th class="text-center" style="width: 100px;">ì°¨ê°ì¼ì</th>
                  <th class="text-center" style="width: 120px;">ë“±ë¡ê¸ˆì•¡</th>
                  <th class="text-center" style="width: 120px;">ì‹¤í–‰ê¸ˆì•¡</th>
                  <th class="text-center" style="width: 120px;">ë¯¸ì°¨ê°</th>
                  <th class="text-center" style="width: 300px;">ë¹„ê³ </th> 
                </tr>
              </thead>
              <tbody class="list"></tbody>
            </table>
          </div> 
          <div class="modal-footer">            
            <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">ë‹«ê¸°</button>
          </div>          
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modal_exc" tabindex="-3" >
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ê³¼ì…ê¸ˆ ë‚´ì—­</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body"> 
          <div class="table-responsive scrollbar">
            <table class="table table-striped table-sm fs-9 mb-0 table-hover" id="tbl_exc_list">
              <thead class="bg-200">
                <tr>
                  <th class="text-center" style="width: 150px;">ê³¼ì… ì½”ë“œëª…</th>
                  <th class="text-center" style="width: 100px;">ë°œìƒì¼ì</th>
                  <th class="text-center" style="width: 120px;">ë“±ë¡ ê¸ˆì•¡</th>
                  <th class="text-center" style="width: 120px;">ì¶œê¸ˆ ê¸ˆì•¡</th>
                  <th class="text-center" style="width: 120px;">ë¯¸ ì¶œê¸ˆ</th>
                  <th class="text-center" style="width: 300px;">ë¹„ê³ </th> 
                </tr>
              </thead>
              <tbody class="list"></tbody>
            </table>
          </div> 
          <div class="modal-footer">            
            <button class="btn btn-secondary" type="button" data-bs-dismiss="modal" >ë‹«ê¸°</button>
          </div>          
        </div>
      </div>
    </div>
  </div>
  
</html>
